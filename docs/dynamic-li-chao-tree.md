---
documentation_of: //structure/convex-hull-trick/dynamic-li-chao-tree.hpp
---

## 概要

直線 $ax+b$ の追加クエリと, ある点 $x$ での最小値クエリを効率的に処理するデータ構造.

セグメント木の各ノードにその区間で最小の直線を載せるイメージ.

直線の追加クエリでは, そのノード $[l, r)$ の既存の直線と比較する. 交差しないとき上側の直線を捨て, 交差するときは $x$ を区間の中心 $\frac {l + r} {2}$ としたときの値の大小関係を比較する. 小さい方をそのノードの直線とし, 大きい方は子に再帰的に追加する.

点 $x$ での最小値クエリでは, $x$ を含むノードが $O(\log n)$ 個なので, それらを見ればよい.

静的な Li-Chao-Tree と動的な Li-Chao-Tree の速度差は(感覚的には)小さいため, 基本的には最小値クエリの先読みが不要な動的な方がおすすめ.

## 使い方

`x_low` には `query()` で与える $x$ の最小値, `x_high` には $x$ の最大値, `id` は単位元(十分大きい値) を指定する. すべての直線について `x_low`, `x_high` がオーバーフローしないとき意図した動作をする.

最大値クエリは最小値クエリに帰着できて, `add_line(-a, -b)`, `-query(x)` とすればよい.


* `add_line(a, b)`: 直線 $ax + b$ を追加する.
* `add_segment(l, r, a, b)`: 区間 $[l, r)$ に線分 $ax + b$ を追加する.
* `query(x)`: $ax + b$ の最小値を求める.

## 計算量

* `add_line(), query()`: $O(\log V)$
* `add_segment()`: $O(\log^2 V)$

$V$ は $x$ が動く範囲.
